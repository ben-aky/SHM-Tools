<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contract Helper</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 60px auto; }
h1 { text-align:center; }
label { display:block; margin-top:20px; font-weight:bold; }
textarea, select, button { width:100%; margin-top:8px; padding:8px; font-size:16px; }
#output { margin-top:30px; padding:15px; border:1px solid #ccc; background-color:#f9f9f9; }
</style>
</head>
<body>
<h1>Contract Helper</h1>

<label for="position">Player Position</label>
<select id="position">
<option value="FWD">Forward</option>
<option value="DEF">Defensemen</option>
</select>

<label for="elc">Post ELC?</label>
<select id="elc">
<option value="False">No, standard non-ELC signing</option>
<option value="True">Yes, player is coming off ELC</option>
</select>

<label for="data">Paste Player Data</label>
<textarea id="data" rows="8" placeholder="Paste player stats here..."></textarea>

<button onclick="calculateContract()">Calculate</button>

<div id="output">
<strong>Result:</strong>
<div id="resultText">No calculation yet.</div>
</div>

<script>
/* ===============================
   CONSTANTS
================================ */
const x_eight = 0.18;
const cap = 95.5;

/* ===============================
   FORWARD DATAFRAME
================================ */
const fdata=[
[99,0,0.21,99,0,0.2,99,0.109947644],[98,0,0.2,98,0,0.2,98,0.109947644],
[97,0,0.19,97,0,0.2,97,0.109947644],[96,0,0.18,96,0,0.2,96,0.109947644],
[95,0,0.17,95,0,0.2,95,0.109947644],[94,0,0.16,94,0,0.2,94,0.109947644],
[93,0,0.15,93,0,0.19,93,0.109947644],[92,0,0.145,92,0,0.175,92,0.09947643979],
[91,0,0.14,91,0,0.16,91,0.09947643979],[90,0,0.135,90,0,0.145,90,0.0890052356],
[89,0,0.12,89,0,0.13,89,0.0890052356],[88,0,0.105,88,0,0.115,88,0.07853403141],
[87,0.09,0.09,87,0,0.1,87,0.06806282723],[86,0,0.08,0.08,86,0,0.085,86,0.05759162304],
[85,0,0.07,85,0,0.07,85,0.04712041885],[84,0,0.06,0.06,84,0,0.055,84,0.03664921466],
[83,0,0.04,83,0,0.04,83,0.02617801047],[82,0,0.032,82,0,0.028,82,0.02094240838],
[81,0,0.024,81,0,0.018,81,0.01570680628],[80,0,0.016,80,0,0.014,80,0.01],
[79,0,0.013,79,0,0.012,79,0.008],[78,0.012,0.012,78,0,0.011,78,0.006],
[77,0.011,0.011,77,0,0.01,77,0.004],[76,0.01,0.01,76,0,0.009,76,0.002],
[75,0.0085,0.0085,75,0,0.005454545455,75,0],[74,0.0085,0.0085,74,0,0.005454545455,74,-0.001047120419],
[73,0.0085,0.0085,73,0,0.005454545455,73,-0.002094240838],[72,0.0085,0.0085,72,0,0.005454545455,72,-0.003141361257],
[71,0.0085,0.0085,71,0,0.005454545455,71,-0.004188481675],[70,0.0085,0.0085,70,0,0.005454545455,70,-0.005235602094]
];

/* ===============================
   DEFENSE DATAFRAME
================================ */
const ddata=[
[99,0,0.2,99,0,0.2,99,9.5,0.2],[98,0,0.2,98,0,0.2,98,9,0.2],[97,0,0.2,97,0,0.2,97,8.5,0.18],
[96,0,0.185,96,0,0.2,96,8,0.16],[95,0,0.17,95,0,0.2,95,7.5,0.14],[94,0,0.15,94,0,0.2,94,7,0.12],
[93,0,0.13,93,0,0.2,93,6.5,0.1],[92,0,0.11,92,0,0.2,92,6,0.09],[91,0,0.1,91,0,0.2,91,5.5,0.08],[90,0,0.09,90,0,0.2,90,5,0.07]
];

/* ===============================
   PARSER
================================ */
function parse(info){
    const parts=info.trim().split(/\s+/);
    const first_name=parts[0], last_name=parts[1];
    let age=null;
    for(const p of parts){ if(/^\d+$/.test(p)){age=parseInt(p,10); break;}}
    const nums=parts.filter(p=>/^\d+$/.test(p)).map(Number);
    return {
        name:first_name+" "+last_name,
        age:age,
        off:nums[nums.length-3],
        def:nums[nums.length-2],
        oa:nums[nums.length-1],
        fa:nums[nums.length-6]||0
    };
}

/* ===============================
   FORWARD CONTRACT
================================ */
function fcontract(player, elc_input){
    const data=parse(player);
    let off=data.off, pdef=data.def, oa=data.oa, age=data.age;
    const elc=elc_input;

    let tw=((off>85 && pdef>80)||(off>82 && pdef>82))?1:0;
    let twoway=(pdef<80)?tw*1.025:tw*1.05;
    let scg=((off<65 && pdef>76)||(off<60 && pdef>74))?1:0;
    let gnval=(pdef>77?0.85:0.55)*scg;
    let elcbonus=(elc=="True")?0.9:1;
    let oneway=(off>79 && pdef<67)?0.85:1;

    let allo=1;
    if(off>92) allo=1.3;
    else if(off>86) allo=1.2;
    else if(off>82) allo=1.1;

    const offVal=fdata.find(r=>r[0]==off)[2]||0;
    const defVal=fdata.find(r=>r[3]==pdef)[5]||0;
    const oaVal=fdata.find(r=>r[6]==oa)[7]||0;

    let sumAllo=(offVal*allo)+defVal+oaVal;
    let sugval;
    if(off<78 && pdef<70) sugval=0.8/82.5;
    else if(twoway>0){
        if(gnval>0) sugval=twoway*gnval*(sumAllo/2);
        else sugval=twoway*(sumAllo/2);
    } else {
        if(gnval>0) sugval=gnval*(sumAllo/2);
        else sugval=sumAllo/2;
    }

    sugval=Math.min(sugval*oneway*elcbonus,0.8);
    let aav=(sugval*cap>(x_eight*cap))?x_eight*cap:sugval*cap;
    if(age>34) aav*=0.9;

    return {off,pdef,oa,age,elc,aav};
}

/* ===============================
   DEFENSE CONTRACT
================================ */
function dcontract(player, elc_input){
    const data=parse(player);
    let off=data.off, pdef=data.def, oa=data.oa, age=data.age, fa=data.fa;
    const elc=elc_input;

    let twoway=(off>78 && pdef>79)?1:0;
    let offensive=(off>79 && pdef<76)?1:0;
    let defensive=(off<74 && pdef>79)?1:0;
    let sgc=(off<68 && pdef>77 && pdef<80)?1:0;
    let tw=twoway?1.2:1;
    let plyoff=offensive?1.05:1;
    let plydef=defensive?1.1:1;
    let sgv=sgc?0.8:1;
    let elcbonus=(elc=="True")?0.9:1;

    let adj_oa=Math.round(((oa*15)-fa)/14);

    let offVal=ddata.find(r=>r[0]==off)[2]||0;
    let defVal=ddata.find(r=>r[3]==pdef)[5]||0;
    let oaVal=ddata.find(r=>r[6]==adj_oa)?ddata.find(r=>r[6]==adj_oa)[8]:0;

    let sumallo=offVal+defVal;
    let sugval=((sumallo/2)*tw*plyoff*plydef*sgv*elcbonus)+oaVal;
    let aav=(sugval*cap>(x_eight*cap))?x_eight*cap:sugval*cap;
    if(age>34) aav*=0.9;

    return {off,pdef,oa,fa,age,elc,aav};
}

/* ===============================
   MAIN BUTTON
================================ */
function calculateContract(){
    const pos=document.getElementById("position").value;
    const elc=document.getElementById("elc").value;
    const rawText=document.getElementById("data").value.trim();
    if(!rawText){document.getElementById("resultText").innerText="Please paste player data.";return;}

    let result;
    if(pos=="FWD") result=fcontract(rawText,elc);
    else result=dcontract(rawText,elc);

    let output=`<b>Player:</b> ${rawText.split(" ").slice(0,2).join(" ")}<br>`;
    output+=`<b>AAV:</b> $${(result.aav*1000000).toLocaleString()}<br><br>`;
    output+=`<b>Offense:</b> ${result.off}<br>`;
    output+=`<b>Defense:</b> ${result.pdef}<br>`;
    output+=`<b>Overall:</b> ${result.oa}<br>`;
    if(pos=="DEF") output+=`<b>FA:</b> ${result.fa}<br>`;
    output+=`<b>Age:</b> ${result.age}<br>`;
    output+=`<b>ELC:</b> ${result.elc}<br>`;
    output+=`<b>AAV (cap %):</b> ${result.aav.toFixed(6)}<br>`;
    if(result.elc=="True") output+=`<i>Max contract length 2â€“3 years</i>`;
    document.getElementById("resultText").innerHTML=output;
}
</script>
</body>
</html>
