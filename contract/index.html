<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contract Helper</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 60px auto; }
h1 { text-align:center; }
label { display:block; margin-top:20px; font-weight:bold; }
textarea, select, button { width:100%; margin-top:8px; padding:8px; font-size:16px; }
#output { margin-top:30px; padding:15px; border:1px solid #ccc; background-color:#f9f9f9; }
</style>
</head>
<body>
<h1>Contract Helper</h1>

<label for="position">Player Position</label>
<select id="position">
<option value="forward">Forward</option>
<option value="defense">Defensemen</option>
</select>

<label for="elc">Post ELC?</label>
<select id="elc">
<option value="false">No, standard non-ELC signing</option>
<option value="true">Yes, player is coming off ELC</option>
</select>

<label for="data">Paste Player Data</label>
<textarea id="data" rows="8" placeholder="Paste player stats here..."></textarea>

<button onclick="calculateContract()">Calculate</button>

<div id="output">
<strong>Result:</strong>
<div id="resultText">No calculation yet.</div>
</div>

<script>
/* CONSTANTS */
const x_eight=0.18, cap=95.5;

/* Forward dataframe */
const fdf=[
{OFF_Rating:99,OFF_CapValue:0.21,DEF_Rating:99,DEF_CapValue:0.2},{OFF_Rating:98,OFF_CapValue:0.2,DEF_Rating:98,DEF_CapValue:0.2},
{OFF_Rating:97,OFF_CapValue:0.19,DEF_Rating:97,DEF_CapValue:0.2},{OFF_Rating:96,OFF_CapValue:0.18,DEF_Rating:96,DEF_CapValue:0.2},
{OFF_Rating:95,OFF_CapValue:0.17,DEF_Rating:95,DEF_CapValue:0.2},{OFF_Rating:94,OFF_CapValue:0.16,DEF_Rating:94,DEF_CapValue:0.2},
{OFF_Rating:93,OFF_CapValue:0.15,DEF_Rating:93,DEF_CapValue:0.19},{OFF_Rating:92,OFF_CapValue:0.145,DEF_Rating:92,DEF_CapValue:0.175},
{OFF_Rating:91,OFF_CapValue:0.14,DEF_Rating:91,DEF_CapValue:0.16},{OFF_Rating:90,OFF_CapValue:0.135,DEF_Rating:90,DEF_CapValue:0.145},
{OFF_Rating:89,OFF_CapValue:0.12,DEF_Rating:89,DEF_CapValue:0.13},{OFF_Rating:88,OFF_CapValue:0.105,DEF_Rating:88,DEF_CapValue:0.115},
{OFF_Rating:87,OFF_CapValue:0.09,DEF_Rating:87,DEF_CapValue:0.1},{OFF_Rating:86,OFF_CapValue:0.08,DEF_Rating:86,DEF_CapValue:0.085},
{OFF_Rating:85,OFF_CapValue:0.07,DEF_Rating:85,DEF_CapValue:0.07},{OFF_Rating:84,OFF_CapValue:0.06,DEF_Rating:84,DEF_CapValue:0.055},
{OFF_Rating:83,OFF_CapValue:0.04,DEF_Rating:83,DEF_CapValue:0.04},{OFF_Rating:82,OFF_CapValue:0.032,DEF_Rating:82,DEF_CapValue:0.028},
{OFF_Rating:81,OFF_CapValue:0.024,DEF_Rating:81,DEF_CapValue:0.018},{OFF_Rating:80,OFF_CapValue:0.016,DEF_Rating:80,DEF_CapValue:0.014},
{OFF_Rating:79,OFF_CapValue:0.013,DEF_Rating:79,DEF_CapValue:0.012},{OFF_Rating:78,OFF_CapValue:0.012,DEF_Rating:78,DEF_CapValue:0.011},
{OFF_Rating:77,OFF_CapValue:0.011,DEF_Rating:77,DEF_CapValue:0.01},{OFF_Rating:76,OFF_CapValue:0.01,DEF_Rating:76,DEF_CapValue:0.009}
];
const foaDf=[
{OA_Rating:99,OA_CapValue:0.109947644},{OA_Rating:98,OA_CapValue:0.109947644},{OA_Rating:97,OA_CapValue:0.109947644},{OA_Rating:96,OA_CapValue:0.109947644},
{OA_Rating:95,OA_CapValue:0.109947644},{OA_Rating:94,OA_CapValue:0.109947644},{OA_Rating:93,OA_CapValue:0.109947644},{OA_Rating:92,OA_CapValue:0.09947643979},
{OA_Rating:91,OA_CapValue:0.09947643979},{OA_Rating:90,OA_CapValue:0.0890052356},{OA_Rating:89,OA_CapValue:0.0890052356},{OA_Rating:88,OA_CapValue:0.07853403141},
{OA_Rating:87,OA_CapValue:0.06806282723},{OA_Rating:86,OA_CapValue:0.05759162304},{OA_Rating:85,OA_CapValue:0.04712041885},{OA_Rating:84,OA_CapValue:0.03664921466},
{OA_Rating:83,OA_CapValue:0.02617801047},{OA_Rating:82,OA_CapValue:0.02094240838},{OA_Rating:81,OA_CapValue:0.01570680628},{OA_Rating:80,OA_CapValue:0.01}
];

/* Defense dataframe */
const ddf=[
{OFF_Rating:99,OFF_CapValue:0.2,DEF_Rating:99,DEF_CapValue:0.2,OA_Rating:99,OA_Value:9.5,OA_CapValue:0.2},
{OFF_Rating:98,OFF_CapValue:0.2,DEF_Rating:98,DEF_CapValue:0.2,OA_Rating:98,OA_Value:9,OA_CapValue:0.2},
{OFF_Rating:97,OFF_CapValue:0.2,DEF_Rating:97,DEF_CapValue:0.2,OA_Rating:97,OA_Value:8.5,OA_CapValue:0.18},
{OFF_Rating:96,OFF_CapValue:0.185,DEF_Rating:96,DEF_CapValue:0.2,OA_Rating:96,OA_Value:8,OA_CapValue:0.16},
{OFF_Rating:95,OFF_CapValue:0.17,DEF_Rating:95,DEF_CapValue:0.2,OA_Rating:95,OA_Value:7.5,OA_CapValue:0.14},
{OFF_Rating:94,OFF_CapValue:0.15,DEF_Rating:94,DEF_CapValue:0.2,OA_Rating:94,OA_Value:7,OA_CapValue:0.12},
{OFF_Rating:93,OFF_CapValue:0.13,DEF_Rating:93,DEF_CapValue:0.2,OA_Rating:93,OA_Value:6.5,OA_CapValue:0.1},
{OFF_Rating:92,OFF_CapValue:0.11,DEF_Rating:92,DEF_CapValue:0.2,OA_Rating:92,OA_Value:6,OA_CapValue:0.09},
{OFF_Rating:91,OFF_CapValue:0.1,DEF_Rating:91,DEF_CapValue:0.2,OA_Rating:91,OA_Value:5.5,OA_CapValue:0.08},
{OFF_Rating:90,OFF_CapValue:0.09,DEF_Rating:90,DEF_CapValue:0.2,OA_Rating:90,OA_Value:5,OA_CapValue:0.07}
];

/* PARSER */
function parse(info){
    const parts=info.trim().split(/\s+/);
    const name=`${parts[0]} ${parts[1]}`;
    let age=null;
    for(const p of parts){
        if(/^\d+$/.test(p)){age=parseInt(p,10); break;}
    }
    const nums=parts.filter(p=>/^\d+$/.test(p)).map(Number);
    return{
        name, age,
        off:nums[nums.length-3],
        def:nums[nums.length-2],
        oa:nums[nums.length-1],
        fa:nums[nums.length-6]||0
    };
}

/* Forward contract */
function fcontractJS(playerText,elc){
    const data=parse(playerText);
    const {name, age, off, def:pdef, oa}=data;

    const tw=((off>85 && pdef>80)||(off>82 && pdef>82))?1:0;
    const twoway=pdef<80?tw*1.025:tw*1.05;
    const scg=((off<65 && pdef>76)||(off<60 && pdef>74))?1:0;
    const gnval=(pdef>77?0.85:0.55)*scg;
    const elcbonus=elc?0.9:1;
    const oneway=(off>79 && pdef<67)?0.85:1;

    let allo=1;
    if(off>92) allo=1.3;
    else if(off>86) allo=1.2;
    else if(off>82) allo=1.1;

    const offVal=fdf.find(r=>r.OFF_Rating===off)?.OFF_CapValue||0;
    const defVal=fdf.find(r=>r.DEF_Rating===pdef)?.DEF_CapValue||0;
    const oaVal=foaDf.find(r=>r.OA_Rating===oa)?.OA_CapValue||0;

    const sumAllo=(offVal*allo)+defVal+oaVal;

    let sugval;
    if(off<78 && pdef<70) sugval=0.8/82.5;
    else if(twoway>0) sugval=gnval>0?twoway*gnval*(sumAllo/2):twoway*(sumAllo/2);
    else sugval=gnval>0?gnval*(sumAllo/2):sumAllo/2;

    sugval=Math.min(sugval*oneway*elcbonus,0.8);
    let aav=Math.min(sugval*cap,x_eight*cap);
    if(age>34) aav*=0.9;
    return {name,age,off,pdef,oa,elc,aav};
}

/* Defense contract */
function dcontractJS(playerText,elc){
    const data=parse(playerText);
    const {name, age, off, def:pdef, oa, fa}=data;

    const twoway=(off>78 && pdef>79)?1:0;
    const offensive=(off>79 && pdef<76)?1:0;
    const defensive=(off<74 && pdef>79)?1:0;
    const sgc=(off<68 && pdef>77 && pdef<80)?1:0;

    const tw=twoway?1.2:1;
    const plyoff=offensive?1.05:1;
    const plydef=defensive?1.1:1;
    const sgv=sgc?0.8:1;
    const elcbonusVal=elc?0.9:1;

    const adj_oa=Math.round(((oa*15)-fa)/14);

    const offVal=ddf.find(r=>r.OFF_Rating===off)?.OFF_CapValue||0;
    const defVal=ddf.find(r=>r.DEF_Rating===pdef)?.DEF_CapValue||0;
    const oaVal=ddf.find(r=>r.OA_Rating===adj_oa)?.OA_CapValue||0;

    const sumallo=offVal+defVal;
    let sugval=((sumallo/2)*tw*plyoff*plydef*sgv*elcbonusVal)+oaVal;
    let aav=Math.min(sugval*cap,x_eight*cap);
    if(age>34) aav*=0.9;

    return {name,age,off,pdef,oa,fa,elc,aav};
}

/* MAIN BUTTON */
function calculateContract(){
    const position=document.getElementById("position").value;
    const elc=document.getElementById("elc").value==="true";
    const rawText=document.getElementById("data").value.trim();
    if(!rawText){document.getElementById("resultText").innerText="Please paste player data.";return;}

    const result=position==="forward"?fcontractJS(rawText,elc):dcontractJS(rawText,elc);

    document.getElementById("resultText").innerHTML=`
        <b>Summary</b><br>
        Player: ${result.name}<br>
        AAV: <b>$${(result.aav*1_000_000).toLocaleString()}</b><br><br>
        <b>Breakdown</b><br>
        Offense: ${result.off}<br>
        Defense: ${result.pdef}<br>
        Overall: ${result.oa}<br>
        ${position==="defense"?`FA: ${result.fa}<br>`:""}
        Age: ${result.age}<br>
        ELC: ${result.elc}<br>
        AAV (cap %): ${result.aav.toFixed(6)}<br>
        ${result.elc?'<i>Max contract length 2â€“3 years</i>':""}
    `;
}
</script>
</body>
</html>
