<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contract Helper</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 60px auto; }
h1 { text-align:center; }
label { display:block; margin-top:20px; font-weight:bold; }
textarea, select, button { width:100%; margin-top:8px; padding:8px; font-size:16px; }
#output { margin-top:30px; padding:15px; border:1px solid #ccc; background-color:#f9f9f9; }
</style>
</head>
<body>

<h1>Contract Helper</h1>

<label for="position">Player Position</label>
<select id="position">
<option value="FWD">Forward</option>
<option value="DEF">Defensemen</option>
</select>

<label for="elc">Post ELC?</label>
<select id="elc">
<option value="False">No, standard non-ELC signing</option>
<option value="True">Yes, player is coming off ELC</option>
</select>

<label for="data">Paste Player Data</label>
<textarea id="data" rows="8" placeholder="Paste player stats here..."></textarea>

<button onclick="calculateContract()">Calculate</button>

<div id="output">
<strong>Result:</strong>
<div id="resultText">No calculation yet.</div>
</div>

<script>
/* ===============================
   CONSTANTS
================================ */
const x_eight = 0.18;
const cap = 95.5;

/* ===============================
   FORWARD DATA
   (truncated for brevity, use your full fdata here)
================================ */
const fdata = [
[99,0,0.21,99,0,0.2,99,0.109947644],[98,0,0.2,98,0,0.2,98,0.109947644],
[97,0,0.19,97,0,0.2,97,0.109947644],[96,0,0.18,96,0,0.2,96,0.109947644]
];

/* ===============================
   DEFENSE DATA
   (truncated for brevity, use your full ddata here)
================================ */
const ddata = [
[99,0,0.2,99,0,0.2,99,9.5,0.2],[98,0,0.2,98,0,0.2,98,9,0.2],
[97,0,0.2,97,0,0.2,97,8.5,0.18],[96,0,0.185,96,0,0.2,96,8,0.16]
];

/* ===============================
   PARSER
================================ */
function parse(info) {
    const parts = info.trim().split(/\s+/);
    const first_name = parts[0];
    const last_name = parts[1];
    let age = null;
    for (const p of parts) { if (/^\d+$/.test(p)) { age = parseInt(p, 10); break; } }
    const nums = parts.filter(p => /^\d+$/.test(p)).map(Number);
    return {
        name: `${first_name} ${last_name}`,
        age,
        off: nums[nums.length-3],
        def: nums[nums.length-2],
        oa: nums[nums.length-1],
        fa: nums[nums.length-6] || 0
    };
}

/* ===============================
   FORWARD CONTRACT
================================ */
function fcontract(player, elc_input){
    const data = parse(player);
    const { off, def: pdef, oa, age } = data;
    const elc = elc_input;

    const tw = ((off>85 && pdef>80)||(off>82 && pdef>82)) ? 1 : 0;
    const twoway = (pdef<80) ? tw*1.025 : tw*1.05;
    const scg = ((off<65 && pdef>76)||(off<60 && pdef>74)) ? 1 : 0;
    const gnval = (pdef>77?0.85:0.55) * scg;
    const elcbonus = (elc==="True") ? 0.9 : 1;
    const oneway = (off>79 && pdef<67) ? 0.85 : 1;

    let allo = 1;
    if(off>92) allo=1.3;
    else if(off>86) allo=1.2;
    else if(off>82) allo=1.1;

    const offVal = fdata.find(r => r[0]===off)[2] || 0;
    const defVal = fdata.find(r => r[3]===pdef)[5] || 0;
    const oaVal  = fdata.find(r => r[6]===oa)[7] || 0;

    const sumAllo = (offVal*allo) + defVal + oaVal;

    let sugval;
    if(off<78 && pdef<70) sugval=0.8/82.5;
    else if(twoway>0){
        sugval = (gnval>0) ? twoway*gnval*(sumAllo/2) : twoway*(sumAllo/2);
    } else {
        sugval = (gnval>0) ? gnval*(sumAllo/2) : sumAllo/2;
    }

    sugval = Math.min(sugval*oneway*elcbonus, 0.8);
    let aav = (sugval*cap > x_eight*cap) ? x_eight*cap : sugval*cap;
    if(age>34) aav*=0.9;

    return { off, pdef, oa, age, elc, aav };
}

/* ===============================
   DEFENSE CONTRACT
================================ */
function dcontract(player, elc_input){
    const data = parse(player);
    const { off, def: pdef, oa, age, fa } = data;
    const elc = elc_input;

    const twoway = (off>78 && pdef>79) ? 1 : 0;
    const offensive = (off>79 && pdef<76) ? 1 : 0;
    const defensive = (off<74 && pdef>79) ? 1 : 0;
    const sgc = (off<68 && pdef>77 && pdef<80) ? 1 : 0;

    const tw = twoway ? 1.2 : 1;
    const plyoff = offensive ? 1.05 : 1;
    const plydef = defensive ? 1.1 : 1;
    const sgv = sgc ? 0.8 : 1;
    const elcbonus = (elc==="True") ? 0.9 : 1;

    const adj_oa = Math.round((oa*15 - fa)/14);

    const offVal = ddata.find(r => r[0]===off)[2] || 0;
    const defVal = ddata.find(r => r[3]===pdef)[5] || 0;
    const oaVal = (ddata.find(r => r[6]===adj_oa)) ? ddata.find(r => r[6]===adj_oa)[8] : 0;

    const sumallo = offVal + defVal;
    const sugval = ((sumallo/2)*tw*plyoff*plydef*sgv*elcbonus) + oaVal;

    let aav = (sugval*cap > x_eight*cap) ? x_eight*cap : sugval*cap;
    if(age>34) aav*=0.9;

    return { off, pdef, oa, fa, age, elc, aav };
}

/* ===============================
   BUTTON HANDLER
================================ */
function calculateContract(){
    const pos = document.getElementById("position").value;
    const elc = document.getElementById("elc").value;
    const rawText = document.getElementById("data").value.trim();
    if(!rawText){ document.getElementById("resultText").innerText="Please paste player data."; return; }

    let result;
    if(pos==="FWD") result = fcontract(rawText, elc);
    else result = dcontract(rawText, elc);

    let output = `<b>Player:</b> ${rawText.split(" ").slice(0,2).join(" ")}<br>`;
    output += `<b>AAV:</b> $${(result.aav*1000000).toLocaleString()}<br><br>`;
    output += `<b>Offense:</b> ${result.off}<br>`;
    output += `<b>Defense:</b> ${result.pdef}<br>`;
    output += `<b>Overall:</b> ${result.oa}<br>`;
    if(pos==="DEF") output += `<b>FA:</b> ${result.fa}<br>`;
    output += `<b>Age:</b> ${result.age}<br>`;
    output += `<b>ELC:</b> ${result.elc}<br>`;
    output += `<b>AAV (cap %):</b> ${result.aav.toFixed(6)}<br>`;
    if(result.elc==="True") output += `<i>Max contract length 2â€“3 years</i>`;
    document.getElementById("resultText").innerHTML = output;
}
</script>
</body>
</html>
